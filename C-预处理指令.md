---
title: C++预处理指令
date: 2020-07-17 10:14:02
categories:
	- C++
tags:
	- C++
---

### 预处理指令

预处理指令以`#`开头，是在编译器进行编译之前进行的操作。预处理过程扫描源代码，对其进行初步的转换，产生新的源代码提供给编译器。预处理过程会完成以下功能：

1. 包含其他源文件
2. 定义宏，进行宏的替换
3. 根据条件决定编译时是否包含某些代码块,防制重复包含某些文件
4. 删除程序中的注释和多余的空白字符

### 常见的各种指令

1. `#`空指令，无效果
2. `#include` 包含一个源代码文件
3. `#define`定义宏
4. `#undef`取消已定义的宏
5. `#if`如果给定的条件为真，编译下面的代码
6. `#ifdef`如果宏已经定义，则编译下面的代码
7. `#ifndef`如果宏没有定义，则编译下面的代码
8. `#elif`和`#if`配套
9. `#endif`结束一个`#if ... #else`条件编译块
10. `#error`停止编译并显示错误信息

###  #include

将头文件插入到对应的位置。

- `<>`括起来，告诉预处理程序在编译器自带的或外部库的头文件中搜索被包含的头文件
- `""`括起来，告诉预处理程序在当前被编译的源代码文件中搜索被包含的头文件

### #define

用于定义宏，预处理过程中会把源代码中出现的宏标识符替换成宏定义的值，仅仅是进行标识符的替换。

在宏定义的时候，由于仅仅是符号的替换，所以尽量使用小括号将参数括起来。

```c++
#define MAX(x, y) ((x) > (y) ? (x): (y))
```

### #indef, #ifndef, #endif

这些是条件编译指令，将决定哪些代码被编译，哪些不被编译。

一般情况下，源程序中所有行都参与编译，但是有时希望对其中一部分内容在满足一定条件下才进行编译，条件不满足时则编译另一组语句。

最常见的命令形式为：

```c++
#ifdef 标识符
程序段1
#else
程序段2
#endif
// 当标识符已经被定义过(用#define命令定义)，则对程序段1进行编译，否则编译程序段2
  
// 其中#else也可以没有
#ifdef
....
#endif
```

```c++
#define DEBUG

#ifdef DEBUG   // 在定义了DEBUG标识符才会被编译，可以通过控制开关来决定是否输出
	cout << "某些内容" << endl;
#endif

#ifndef DEBUG
	balabala
#endif
```

### 头文件中的#ifdef与#ifndef

在头文件中使用`#ifdef/#ifndef`是非常重要的，可以防止同一个头文件被包含多次而导致双重定义的错误。假如有如下的结构。其中`head1.hh`和`head2.hh`中都`include`了`base.hh`，而且`base.hh`中定义了一些变量，然后再`main.cpp`中`include`了`head1.hh`和`head2.hh`，在编译的过程中就会发生重复定义的错误。

```txt
.
├── base.hh
├── head1.hh
├── head2.hh
└── main.cpp
```

解决办法是，在每个头文件一开始定义一个属于这个头文件的标识符，只有在没有定义这个标识符的情况下，才进行操作。

如果已经包含了这个文件，那么`_BASE_HH_`就会有了定义，条件为假，就不会执行后面的类定义。

```c++
#ifndef _BASE_HH_ 
#define _BASE_HH_
// 标识可以自由命名，但每个头文件的这个标识应该是唯一的
// 标识的命名规则一般是头文件名全大写，前后加下划线，且头文件中的.也变成下划线
balabala;

#endif
```

#### 参考文献

[文献1](https://www.cnblogs.com/zi-xing/p/4550246.html)

[文献2](http://chen-tao.github.io/2015/11/17/c-cpp-preprocessor/)

[文献3](https://www.cnblogs.com/Jessica-jie/p/9006929.html)